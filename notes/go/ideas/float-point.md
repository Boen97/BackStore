# 浮点数

## 定点数

> 约定计算机中小数点的位置，且这个位置不变
> 小数点前后分别用二进制表示,然后组合起来在计算中进行存储

### 定点数表示数字

- D 表示 10进制，B 表示 2进制,假设我们使用 1个字节，8 bit来存储定点数

1. 纯整数，例如 100，小数点在最后一位，忽略不写
   100(D) = 0110_0100(B)
2. 纯小数，例如 0.123，小数点固定在最高位
   采用十进制小数转二进制小数，得 0.125(D) = (0.0010_0000)
3. 整数 + 小数， 例如 1.24， 10.34，小数点在指定某个位置,`需要约定小数点的位置`

#### 定点数表示 整数 + 小数

1. 约定小数点的位置
- 以一个字节（8 bit）为例，约定 `前5位` 表示整数部分，`后3位` 表示小数部分
- `1.5(D) = 00001 100(B)`
- `25.125(D) = 11001 001(B)`

- 在有限的 bit 宽度下，先约定小数点的位置
- 整数部分和小数部分，分别转换为二进制表示
- 两部分二进制组合起来，即是结果

问题1:
- 约定了 前 5 位表示整数部分，后 3 位表示小数部分，此时整数部分的二进制最大值只能是11111，即十进制31，
- 小数部分的二进制最大只能表示 0.111，即十进制的0.875

问题2:
- 如果我们想要表示更大范围的值
1. 扩大bit的宽度，使用2个字节，4个字节
2. 改变小数点的位置，小数点向后移动，整个数字范围就会扩大，但是小数部分的精度就会越来越低

问题3:
- 不管如何约定小数点的位置，都会存在以下问题：
1. 数值的表示范围有限，小数点越靠左，整个数值范围越低
2. 数值的精度范围有限，小数点越靠右，数值精度越低

> 总的来说，用定点数表示的小数，不仅数值的范围表示有限，而且其精度也很低
> 要想解决这两个问题，人们就提出了「浮点数」的方式表示数字

> 现代计算机中一般使用定点数来表示整数

## 浮点数

- 在计算机中，一般使用浮点数来表示小数

> 定点数是约定小数点位置固定不变
> 浮点数的「浮点」就是指，其小数点的位置是可以`漂浮不定`的

> 浮点数是采用「科学计数法」的方式来表示的

- 例如十进制小数 8.345，用科学计数法表示，可以有多种方式

```
8.345 = 8.345 * 10^0
8.345 = 83.45 * 10^-1
8.345 = 834.5 * 10^-2
```

- 用这种科学计数法的方式表示小数时，小数点的位置就变得漂浮不定了，这就是相对于定点数，浮点数名字的由来。

### 浮点数如何表示数字？

`V = (-1)^S * M * R^E`

- S: 符号位，取 0 或 1， 决定一个数字的符号，0表示正，1表示负
- M: 尾数，用小数表示，例如 8.345 * 10^0, 8.345 就是尾数
- R: 基数，表示十进制数 R 就是 10, 表示二进制数 R 就是 2
- E: 指数，用整数表示，例如前面看到的 10^-1, -1 就是指数

假设我们用32bit表示一个浮点数
1. 符号位 S 占 1 bit
2. 指数 E 占 10 bit
3. 尾数 M 占 21 bit

例如将 十进制25.125 转换为浮点数 (D 表示十进制， B 表示二进制)
1. 整数部分： 25(D) = 11001(B)
2. 小数部分： 0.125(D) = 0.001(B)
3. 用二进制科学计数法表示： 25.125(D) = 11001.001(B) = 1.1001001 * 2^4(B)
4. 所以符号位 S = 0, 尾数 M = 1.1001001(B), 指数 E = 4(D) = 100(B)
5. 按照上面的定义，填充到 32 bit上，得到
- S(1bit)E(10bit)M(21bit)
- 0_1000000000_1001001000000...

- 指数和尾数分配的位数不同，会产生以下情况：
1. 指数位越多，尾数位则越少，表示的范围越大，精度越低，反之，精度越好
2. 一个数字的浮点数格式，会因为定义的规则不同，得到的结果也不同，表示的范围和精度也会不同

- 业界定义了统一的浮点数标准,IEEE754 浮点数标准，该组织提供了2种浮点数格式：
1. 单精度浮点数 32位，符号位S占1bit,指数E占8bit,尾数占23bit
2. 双精度浮点数 64位，符号位S占1bit,指数E占11bit,尾数M占52bit

- 为了使其表示的数字范围、精度最大化，浮点数标准还对指数和尾数进行了规定：
1. 尾数M的第一位总是1，因此这个1可以省略不写，它是个隐藏位，这样单精度23位尾数可以表示24位有效数字，双精度可以表示53位有效数字
2. 指数E是个无符号整数，表示float时，一共占8bit,所以它的取值范围为0~255
   但因为指数可以是负的，所以规定在存入E时在它原本的值加上一个`中间数127`,这样E得取值范围为 -127 ～ 128
   表示double时，一共占11bit,存入E时加上`中间数1023`,这样E的取值范围为 -1023 ～ 1024

### 标准浮点数的表示，把25.125转化为标准的float浮点数
1. 整数部分 25(D) = 11001(B)
2. 小数部分 0.125(D) = 0.001(B)
3. 用二进制科学计数法表示：25.125(D) = 11001.001(B) = 1.1001001 * 2^4(B)
4. S = 0, M = 1.1001001=1001001(去掉1，隐藏位)，E = 4 + 127(中间数) = 135(D) = 10000111(B)

### 浮点数为什么有精度损失

- 现在我们想用浮点数表示 0.2
- 在 0.2 转化为二进制数的过程中，不断乘以2，直到不存在小数为止，但是实际上会发生循环

```
0.2 * 2 = 0.4 -> 0
0.4 * 2 = 0.8 -> 0
0.8 * 2 = 1.6 -> 1
0.6 * 2 = 1.2 -> 1
0.2 * 2 = 0.4 -> 0（发生循环）
...
```

- 因为十进制的0.2无法精确转化为二进制小数，而计算机在表示一个数字时，宽度是有限的
- 无限循环的小数存储在计算机时，只能被截断，所以就会导致小数精度发生损失

### 浮点数的范围和精度有多大？

- 单精度浮点数 float,它能表示的最大二进制数为 +1.1111..1 * 2 ^ 127 (小数点后23个1)
- 而二进制1.111...1 约等于 2，所以 float 能表示的最大数为 2 ^ 128 = 3.4 * 10^38
- float 表示的范围为 -3.4 * 10^38 ~ 3.4 * 10^38
- float表示的精度 0.0000...1 小数点后22个0， 1个1，用十进制表示就是 1/2^23
